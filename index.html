<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ranch Lab – Home</title>

  <style>
    :root {
      --bg: #faf7ff;
      --ink: #1f2937;
      --ink2: #4b5563;
      --brand: #6d28d9;
      --card: #ffffff;
      --line: #e5e7eb;
      --success: #10b981;
      --warning: #f59e0b;
      --shadow: 0 10px 25px rgba(17, 24, 39, 0.07);
      --modal-purple: #f3e8ff; /* purple modal background */
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Inter, Helvetica, Arial, sans-serif;
      color: var(--ink);
      background: var(--bg);
      line-height: 1.6;
    }

    a { color: var(--brand); text-decoration: none; }
    a:hover { text-decoration: underline; }

    header {
      position: sticky; top: 0;
      backdrop-filter: saturate(140%) blur(6px);
      background: rgba(250, 247, 255, 0.85);
      border-bottom: 1px solid var(--line);
      z-index: 50;
    }
    .nav { max-width: 900px; margin: auto; display: flex; gap: 16px; align-items: center; justify-content: space-between; padding: 12px 16px; }

    main { max-width: 900px; margin: 24px auto; padding: 0 16px; }
    section { background: var(--card); border: 1px solid var(--line); border-radius: 16px; padding: 24px; margin: 24px 0; box-shadow: 0 2px 10px rgba(0,0,0,.03); }

    h1 { font-size: 32px; margin: 0 0 8px; font-weight: 700; }
    h2 { font-size: 24px; margin: 0 0 16px; font-weight: 600; }
    h3 { font-size: 18px; margin: 0 0 8px; font-weight: 600; }
    p { color: var(--ink2); margin: 8px 0; }

    /* How it works */
    .how-wrap {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      align-items: stretch;
    }
    @media (min-width: 768px) { .how-wrap { grid-template-columns: 1fr auto 1fr auto 1fr; } }

    .how-card { background: linear-gradient(180deg, #ffffff 0%, #f3f4f6 100%); border: 1px solid var(--line); border-radius: 16px; padding: 24px; text-align: center; box-shadow: var(--shadow); height: 100%; }
    .how-num { width: 40px; height: 40px; border-radius: 999px; margin: 0 auto 12px; background: var(--brand); color: #fff; display: grid; place-items: center; font-weight: 800; box-shadow: 0 6px 18px rgba(109,40,217,.35); }
    .how-arrow { 
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px; 
      color: var(--brand); 
      font-weight: 800; 
    }
    @media (min-width: 768px) { .how-arrow { display: flex; } }

    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 768px) { .grid { grid-template-columns: 1fr 1fr; } .grid-3 { grid-template-columns: 1fr 1fr 1fr; } }

    .card { border: 1px solid var(--line); border-radius: 12px; padding: 16px; background: var(--card); }

    .menu-item { border: 1px solid var(--line); border-radius: 12px; padding: 16px; background: var(--card); transition: border-color .2s; }
    .menu-item:hover { border-color: var(--brand); }

    .muted { color: var(--ink2); }

    .btn { appearance: none; border: 0; background: var(--brand); color: #fff; padding: 12px 20px; border-radius: 16px; cursor: pointer; font-weight: 700; font-size: 18px; transition: background .2s; text-align: center; display: inline-block; }
    .btn:hover { background: #5b21b6; }
    .btn:disabled { opacity: .5; cursor: not-allowed; }

    .btn-outline { background: #fff; color: var(--brand); border: 3px solid var(--brand); border-radius: 16px; padding: 12px 20px; font-weight: 700; font-size: 18px; }
    .btn-outline:hover { background: rgba(109,40,217,.06); }

    .cta { 
      display: flex; 
      gap: 24px; 
      flex-wrap: wrap; 
      margin-top: 12px; 
    }
    .cta .btn, .cta .btn-outline {
      min-width: 150px;
    }

    .form-row { display: flex; flex-direction: column; gap: 6px; margin: 12px 0; }
    input[type=text],input[type=email],input[type=tel],input[type=number],select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--line); font-size: 14px; background: #fff; }
    input[type=number]{ max-width: 80px; }

    .price-display { font-weight: 600; color: var(--brand); font-size: 18px; margin: 8px 0; }
    .item-total { font-size: 14px; color: var(--ink2); margin-top: 8px; }

    .order-summary { background: #f8fafc; padding: 16px; border-radius: 8px; margin: 16px 0; min-height: 60px; }
    .totals { display: grid; grid-template-columns: 1fr auto; row-gap: 8px; column-gap: 20px; margin: 16px 0; }
    .totals div:last-child { text-align: right; }

    .fulfillment-options { display: flex; gap: 20px; margin: 24px 0; justify-content: center; flex-wrap: wrap; }
    .fulfillment-btn { flex: 1; min-width: 240px; max-width: 280px; padding: 24px 20px; background: var(--card); border: 2px solid var(--line); border-radius: 16px; cursor: pointer; transition: all .2s ease; text-align: center; }
    .fulfillment-btn:hover { border-color: var(--brand); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(109,40,217,.15); }
    .fulfillment-btn.selected { border-color: var(--brand); background: rgba(109,40,217,.05); box-shadow: 0 4px 20px rgba(109,40,217,.2); }
    .fulfillment-icon { font-size: 32px; margin-bottom: 12px; }

    .schedule-container { background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0; border: 1px solid var(--line); }
    .schedule-explanation { color: var(--ink2); margin: 0 0 16px; font-style: italic; text-align: center; }
    .date-time-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 768px) { .date-time-selector { grid-template-columns: 1fr; } }
    .delivery-cta-flex { display: flex; justify-content: center; margin-top: 16px; }

    .order-item { display: flex; justify-content: space-between; align-items: flex-start; padding: 12px 0; border-bottom: 1px solid #e5e7eb; }
    .order-item:last-child { border-bottom: none; }
    .order-item-name { font-weight: 500; color: var(--ink); margin-bottom: 4px; }
    .order-item-qty { font-size: 14px; color: var(--ink2); }
    .order-item-price { font-weight: 500; color: var(--ink); }

    footer { max-width: 900px; margin: 28px auto; padding: 0 16px 40px; color: var(--ink2); text-align: center; }
    footer hr { border: 0; border-top: 1px solid var(--line); margin: 20px 0; }
    footer .note { margin-top: 12px; }
    .hero { display: flex; flex-direction: column; gap: 12px; margin: 8px 0 8px; }

    /* Message Box */
    .message-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: var(--warning); color: #fff; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, .1); z-index: 100; transition: opacity .3s; opacity: 0; }
    .message-box.show { opacity: 1; }

    /* Modals */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(17,24,39,.5); display: none; align-items: center; justify-content: center; padding: 16px; z-index: 1000; }
    .modal-backdrop.show { display: flex; }
    .modal-card { 
      background: var(--modal-purple); 
      border: 1px solid var(--line); 
      border-radius: 16px; 
      box-shadow: var(--shadow); 
      width: 384px; 
      height: 480px; /* Adjusted height for 2x3 grid */
      overflow: hidden; 
      padding: 0; 
      position: relative; 
      color: #1f2937; 
      display: flex;
      flex-direction: column;
    }
    .modal-card > * {
      padding-left: 1cm;
      padding-right: 1cm;
    }
    .modal-card h2 {
      padding-left: 16px;
      padding-right: 16px;
    }
    .modal-card .modal-close {
      top: 10px;
      right: 12px;
      padding: 0;
    }
    @media (max-width: 800px) {
      .modal-card { width: 95vw; height: 80vh; }
    }
    .modal-close { position: absolute; top: 10px; right: 12px; border: 0; background: transparent; cursor: pointer; font-size: 22px; color: var(--ink); }
    .modal-close.btn-cooking { background: rgba(255, 255, 255, 0.9); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; z-index: 1001; }
    .modal-content { padding: 20px; width: 20cm; height: 20cm; overflow: auto; }

    .btn-row { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 12px; }
    .btn-small { font-size: 14px; padding: 8px 16px; border-radius: 12px; }
    .menu-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; flex-wrap: wrap; }

    /* Instagram Placeholder styles */
    .instagram-placeholder {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      background: #fafafa;
      border-radius: 16px;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .instagram-header {
      display: flex;
      flex-direction: row;
      align-items: center;
    }
    .profile-pic-placeholder {
      background-color: #e0e0e0;
      border-radius: 50%;
      flex-grow: 0;
      height: 40px;
      margin-right: 14px;
      width: 40px;
    }
    .text-placeholder {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      justify-content: center;
    }
    .line-1, .line-2 {
      background-color: #e0e0e0;
      border-radius: 4px;
      flex-grow: 0;
      height: 14px;
      margin-bottom: 6px;
    }
    .line-1 { width: 100px; }
    .line-2 { width: 60px; }
    
    /* New Instagram grid for 3x3 layout */
    .instagram-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      padding: 16px;
      max-width: 100%;
      box-sizing: border-box;
    }

    /* Style for individual image placeholders within the grid */
    .instagram-grid .image-placeholder {
      width: 100%;
      padding-bottom: 100%; /* Creates a square aspect ratio */
      background-color: #e0e0e0; /* Grey background for visual placeholder */
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <header>
    <nav class="nav" aria-label="primary"></nav>
  </header>

  <main>
    <div id="message-box" class="message-box"></div>

    <section id="intro">
      <div class="hero">
        <h1>Fire-inspired cooking crafted from my travels</h1>
        <div class="cta">
          <a class="btn" id="openStory" href="#">My Story</a>
          <a class="btn btn-outline" id="openCooking" href="#">My Cooking</a>
        </div>
      </div>
    </section>

    <section id="how">
      <h2>How It Works</h2>
      <div class="how-wrap">
        <div class="how-card">
          <div class="how-num">1</div>
          <h3>Choose Your Menu</h3>
          <p class="muted">Select from our seasonal offerings crafted with intention</p>
        </div>
        <div class="how-arrow">→</div>
        <div class="how-card">
          <div class="how-num">2</div>
          <h3>Select Pickup or Delivery</h3>
          <p class="muted">Pick up at our kitchen or arrange Uber delivery</p>
        </div>
        <div class="how-arrow">→</div>
        <div class="how-card">
          <div class="how-num">3</div>
          <h3>Order</h3>
          <p class="muted">Secure checkout with instant confirmation</p>
        </div>
      </div>
    </section>

    <section id="menu">
      <div class="menu-header">
        <h2 style="margin: 0;">Fall Menu: Ember &amp; Sea</h2>
        <button class="btn btn-outline btn-small" id="openWinter">Winter: Dolomites &amp; Piedmont</button>
        <button class="btn btn-outline btn-small" id="openSpring">Spring: Japan</button>
        <button class="btn btn-outline btn-small" id="openSummer">Summer: Baja</button>
      </div>
      <div class="grid">
        <div class="menu-item">
          <h3>Roasted Pepper Spread &amp; Grilled Bread</h3>
          <div class="muted">Fire-roasted red peppers with churned local cream, lightly smoked over oak. Served with house-made sourdough.</div>
          <div class="price-display">$12.00</div>
          <div class="form-row">
            <label>Quantity</label>
            <input type="number" min="0" value="0" step="1" data-price="12" data-name="Roasted Pepper Spread & Grilled Bread" class="qty" />
          </div>
          <div class="item-total">Total: $<span class="item-subtotal">0.00</span></div>
        </div>

        <div class="menu-item">
          <h3>Autumn Mushrooms</h3>
          <div class="muted">Chanterelles &amp; porcini seared over live coals with olive oil, herbs, and flaky salt.</div>
          <div class="price-display">$18.00</div>
          <div class="form-row">
            <label>Quantity</label>
            <input type="number" min="0" value="0" step="1" data-price="18" data-name="Autumn Mushrooms" class="qty" />
          </div>
          <div class="item-total">Total: $<span class="item-subtotal">0.00</span></div>
        </div>

        <div class="menu-item">
          <h3>Wood-Fired Ribeye</h3>
          <div class="muted">Prime ribeye over oak coals, finished with herb butter &amp; sea salt. Serves 2.</div>
          <div class="price-display">$45.00</div>
          <div class="form-row">
            <label>Quantity</label>
            <input type="number" min="0" value="0" step="1" data-price="45" data-name="Wood-Fired Ribeye" class="qty" />
          </div>
          <div class="item-total">Total: $<span class="item-subtotal">0.00</span></div>
        </div>

        <div class="menu-item">
          <h3>Charred Seasonal Vegetables</h3>
          <div class="muted">Market vegetables over live fire with olive oil, lemon, and herbs.</div>
          <div class="price-display">$16.00</div>
          <div class="form-row">
            <label>Quantity</label>
            <input type="number" min="0" value="0" step="1" data-price="16" data-name="Charred Seasonal Vegetables" class="qty" />
          </div>
          <div class="item-total">Total: $<span class="item-subtotal">0.00</span></div>
        </div>
      </div>
    </section>

    <section id="order">
      <h2>Select Pickup or Delivery</h2>

      <div class="fulfillment-options">
        <button class="fulfillment-btn" id="pickupBtn">
          <div class="fulfillment-icon">📍</div>
          <h3>Pick Up</h3>
          <p>Select your pickup date &amp; time</p>
        </button>
        <button class="fulfillment-btn" id="deliveryBtn">
          <div class="fulfillment-icon">🚚</div>
          <h3>Delivery</h3>
          <p>Via Uber (you pay Uber separately)</p>
        </button>
      </div>

      <div id="pickupSchedule" style="display:none" class="schedule-container">
        <p class="schedule-explanation">Selecting a pickup time helps us have your order ready.</p>
        <div class="date-time-selector">
          <div class="form-row">
            <label>Select Date</label>
            <select id="pickupDate">
              <option value="">Choose a date...</option>
              <option value="2025-10-04">October 4, 2025</option>
              <option value="2025-10-05">October 5, 2025</option>
              <option value="2025-11-01">November 1, 2025</option>
              <option value="2025-11-02">November 2, 2025</option>
              <option value="2025-12-06">December 6, 2025</option>
              <option value="2025-12-07">December 7, 2025</option>
            </select>
          </div>
          <div class="form-row">
            <label>Select Time Slot</label>
            <select id="pickupTime" disabled>
              <option value="">First select a date</option>
            </select>
          </div>
        </div>
      </div>

      <div id="deliverySchedule" style="display:none" class="schedule-container">
        <p class="schedule-explanation">Choose when your order should be ready for Uber pickup.</p>
        <div class="date-time-selector">
          <div class="form-row">
            <label>Select Date</label>
            <select id="deliveryDate">
              <option value="">Choose a date...</option>
              <option value="2025-10-04">October 4, 2025</option>
              <option value="2025-10-05">October 5, 2025</option>
              <option value="2025-11-01">November 1, 2025</option>
              <option value="2025-11-02">November 2, 2025</option>
              <option value="2025-12-06">December 6, 2025</option>
              <option value="2025-12-07">December 7, 2025</option>
            </select>
          </div>
          <div class="form-row">
            <label>Select Time Slot</label>
            <select id="deliveryTime" disabled>
              <option value="">First select a date</option>
            </select>
          </div>
        </div>
        <div class="delivery-cta-flex" id="uberBtnContainer">
          </div>
      </div>
    </section>

    <section id="payment">
      <h2>Order</h2>

      <div class="grid">
        <div class="card">
          <h3>Order Summary</h3>
          <div id="orderSummary" class="order-summary"><p class="muted">No items selected</p></div>
          <div class="totals">
            <div>Subtotal</div><div id="subtotal">$0.00</div>
            <div>CA Tax (10.25%)</div><div id="tax">$0.00</div>
            <div><strong>Total</strong></div><div id="total"><strong>$0.00</strong></div>
          </div>
        </div>

        <div class="card">
          <h3>Payment Details</h3>
          <div class="form-row">
            <label>Full Name *</label>
            <input id="customerName" type="text" placeholder="Your full name" required>
          </div>
          <div class="form-row">
            <label>Email *</label>
            <input id="customerEmail" type="email" placeholder="your@email.com" required>
          </div>
          <div class="form-row">
            <label>Phone Number *</label>
            <input id="customerPhone" type="tel" placeholder="(310) 666-0797" required>
          </div>
          <button id="submit-order" class="btn" style="width:100%; margin-top:16px;">Complete Order</button>
          <p class="note">Payment integration coming soon. You'll receive confirmation via email.</p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <hr />
    <div class="note">
      Questions? <a href="mailto:milos@ranchlab.is">milos@ranchlab.is</a> · 
      <a href="tel:+13106660797">(310) 666-0797</a>
    </div>
  </footer>

  <div id="storyModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card modal-content" role="dialog" aria-modal="true" aria-labelledby="storyTitle">
      <button class="modal-close" aria-label="Close" id="closeStory">&times;</button>
      <h2 id="storyTitle">My Story: From the Ocean to the Fire</h2>
      <p>I'm Milos, a longtime Bay Area resident, new Piedmont neighbor, first-time dad, and former sustainable fashion entrepreneur. Last August, I sold my third company: a zero-plastic apparel brand built on the principles of circularity. We created apparel and footwear designed to last a lifetime, yet capable of being composted back into soil that can grow anything green and alive.</p>
      <p>After years of building businesses, I've decided to follow a different path and one of my deepest personal passions: food and wellness. Cooking has always been a daily ritual in our home, especially since becoming a parent. Friends and family kept telling me, "You should offer this to others." So I am. And as with everything I've built, I'm doing it in a way that feels entirely my own.</p>
      <p>Spearfishing was my stepping stone to true freshness. That first yellowtail and yellowfin I caught, hours from ocean to plate, taught me that when ingredients are this pure, they need almost nothing more.</p>
      <p>The same is true for everything I cook with.  I want to know the story behind each ingredient: where it came from, how it was made, and who made it. Just as wine lovers trace a winemaker's path to each vintage, I search for those "winemakers" in every element of food. From hand-pressed olive oil to centuries-old fermentation techniques, the process matters as much as the outcome because the process is the alchemy. It's a living library, and every ingredient holds a chapter worth studying.</p>
      <p>To me, flavor is a fine balance between purity and complexity. When done right, flavor is also health. We evaluate growers, makers, and artisans through flavor. When the balance is just right, that evaluation turns into trust. That trust extends to our health, because when food is grown and made with integrity, health follows naturally.</p>
      <p>Flavor is our contract with the growers, makers, and artisans we work with. The better the flavor, the deeper the bond. My goal is to create the strongest bond possible.</p>
      <p>Fire is how I honor that contract. It demands patience and presence. Wood is nature's seasoning, each variety leaving its own signature. Mesquite is the full-bodied cabernet of woods. Fruit woods bring a gentle, fragrant sweetness. Together, they create new possibilities but also demand restraint and intuition to truly heighten each ingredient's essence.</p>
      <p>What I share isn't just a meal. It's the sum of relationships, craft, and a relentless pursuit of flavor, health, joy, creativity, and sustainability. This fall marks the first chapter: a menu inspired by the fire traditions of San Sebastián and the visionary chef behind Asador Etxebarri, whose mastery has inspired chefs around the world to embrace the art of cooking over live fire.</p>
    </div>
  </div>

  <div id="winterModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="winterTitle">
      <button class="modal-close" aria-label="Close" id="closeWinter">&times;</button>
      <h2 id="winterTitle">Winter: Dolomites &amp; Piedmont</h2>
      <p>Skiing and hiking initially drove me to this region. A memory that's inspiring the winter, alpine menu is Italian-Austrian chef, Norbert Niederkofler's Cook the Mountain philosophy.</p>
      <p>Ingredients that I am thinking about are chestnuts, polenta, char, char, trout, truffles, wild boar, veal, fermented root veggies.</p>
      <img src="https://i.ibb.co/CByPzR1/dolomites.jpg" alt="Dolomites Mountain Scenery with Food and Beer" style="width:100%; height:auto; display:block; margin-top: 20px; border-radius: 8px;" />
    </div>
  </div>

  <div id="springModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="springTitle">
      <button class="modal-close" aria-label="Close" id="closeSpring">&times;</button>
      <h2 id="springTitle">Spring: Japan</h2>
      <p>I'd love to spend time living in Japan. My first true introduction came through my friend's Tokyo restaurant, Udatsu, which earned the fastest Michelin star in Japan, and through skiing the legendary powder of Hokkaido.</p>
      <p>For cherry blossom season, the menu will center on cherry wood smoke, yakitori, yellowtail, king crab, saba, and wagyu, miso and koji fermentation.</p>
      <img src="https://i.ibb.co/hL4b041/japan.jpg" alt="Japanese Crab Hot Pot" style="width:100%; height:auto; display:block; margin-top: 20px; border-radius: 8px;" />
    </div>
  </div>

  <div id="summerModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="summerTitle">
      <button class="modal-close" aria-label="Close" id="closeSummer">&times;</button>
      <h2 id="summerTitle">Summer: Baja</h2>
      <p>My introduction to Baja began in Cerritos and Todos Santos. Baja is a waterman's dream. The menu will be inspired by my favorite fish, Kampachi (amberjack) and Anthony Bourdain's beloved Ensenada cevichería, La Guerrerense.</p>
      <p>Ceviche, pastor, short rib, nopales, agave and more.</p>
      <img src="https://i.ibb.co/L95m606/baja.jpg" alt="Baja Ceviche" style="width:100%; height:auto; display:block; margin-top: 20px; border-radius: 8px;" />
    </div>
  </div>

  <div id="cookingModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="cookingTitle">
      <button class="modal-close btn-cooking" aria-label="Close" id="closeCooking">&times;</button>
      <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/myranchlab/" data-instgrm-version="14">
        <div class="instagram-placeholder">
          <a href="https://www.instagram.com/myranchlab/" target="_blank">
            <div class="instagram-header">
              <div class="profile-pic-placeholder"></div>
              <div class="text-placeholder">
                <div class="line-1"></div>
                <div class="line-2"></div>
              </div>
            </div>
          </a>
          <div class="instagram-grid">
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
            <div class="image-placeholder"></div>
          </div>
        </div>
      </blockquote>
      <script async src="//www.instagram.com/embed.js"></script>
    </div>
  </div>
  <script>
    function showMessage(message, type = 'warning') {
      const msgBox = document.getElementById('message-box');
      if (!msgBox) return;
      msgBox.textContent = message;
      msgBox.style.backgroundColor = type === 'success' ? 'var(--success)' : 'var(--warning)';
      msgBox.classList.add('show');
      setTimeout(() => { msgBox.classList.remove('show'); }, 3000);
    }

    const Cart = (function () {
      const TAX_RATE = 0.1025;
      function readCart() {
        return Array.from(document.querySelectorAll('.menu-item'))
          .map(card => {
            const input = card.querySelector('.qty');
            const name = input?.dataset.name || '';
            const price = parseFloat(input?.dataset.price || '0');
            const qty = parseInt(input?.value || '0', 10) || 0;
            return { name, price, qty };
          })
          .filter(i => i.qty > 0);
      }
      function renderSummary() {
        const cart = readCart();
        const summaryEl = document.getElementById('orderSummary');
        const subEl = document.getElementById('subtotal');
        const taxEl = document.getElementById('tax');
        const totalEl = document.getElementById('total');
        if (!summaryEl) return;
        if (cart.length === 0) {
          summaryEl.innerHTML = '<p class="muted">No items selected</p>';
        } else {
          summaryEl.innerHTML = cart.map(i => `
            <div class="order-item">
              <div class="order-item-details">
                <div class="order-item-name">${i.name}</div>
                <div class="order-item-qty">Qty: ${i.qty}</div>
              </div>
              <div class="order-item-price">$${(i.price * i.qty).toFixed(2)}</div>
            </div>
          `).join('');
        }
        const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
        const tax = subtotal * TAX_RATE;
        const total = subtotal + tax;
        if (subEl) subEl.textContent = `$${subtotal.toFixed(2)}`;
        if (taxEl) taxEl.textContent = `$${tax.toFixed(2)}`;
        if (totalEl) totalEl.innerHTML = `<strong>$${total.toFixed(2)}</strong>`;
      }
      function onQtyChange(input) {
        const qty = parseInt(input.value || '0', 10) || 0;
        const price = parseFloat(input.dataset.price || '0') || 0;
        const itemSubtotalEl = input.closest('.menu-item')?.querySelector('.item-subtotal');
        if (itemSubtotalEl) itemSubtotalEl.textContent = (qty * price).toFixed(2);
        renderSummary();
        saveCart();
      }
      function saveCart() {
        const cart = readCart();
        try { localStorage.setItem('ranchlab_cart', JSON.stringify(cart)); } catch (e) {}
      }
      function restoreCart() {
        try {
          const saved = localStorage.getItem('ranchlab_cart');
          if (!saved) return;
          const cart = JSON.parse(saved);
          cart.forEach(i => {
            const input = document.querySelector(`.qty[data-name="${i.name}"]`);
            if (input) input.value = i.qty;
          });
        } catch (e) {}
      }
      function setupEventListeners() {
        document.querySelectorAll('.qty').forEach(input => {
          onQtyChange(input);
          input.addEventListener('input', () => onQtyChange(input));
          input.addEventListener('change', () => onQtyChange(input));
        });
      }
      function init() {
        restoreCart();
        setupEventListeners();
        renderSummary();
      }
      return {
        init: init,
        readCart: readCart
      };
    })();

    const Fulfillment = (function () {
      const UBER_PICKUP_LATITUDE = 37.8244;
      const UBER_PICKUP_LONGITUDE = -122.232;
      const UBER_PICKUP_NICKNAME = 'Ranch Lab';
      const UBER_PICKUP_ADDRESS = '964 Rose Avenue, Piedmont, CA, 94611';
      function selectChoice(type) {
        const pickupBtn = document.getElementById('pickupBtn');
        const deliveryBtn = document.getElementById('deliveryBtn');
        const pickupSchedule = document.getElementById('pickupSchedule');
        const deliverySchedule = document.getElementById('deliverySchedule');
        pickupBtn.classList.remove('selected');
        deliveryBtn.classList.remove('selected');
        pickupSchedule.style.display = 'none';
        deliverySchedule.style.display = 'none';
        if (type === 'pickup') {
          pickupBtn.classList.add('selected');
          pickupSchedule.style.display = 'block';
        } else {
          deliveryBtn.classList.add('selected');
          deliverySchedule.style.display = 'block';
        }
      }
      function updateTimes(type) {
        const dateEl = document.getElementById(type + 'Date');
        const timeEl = document.getElementById(type + 'Time');
        const uberBtnContainer = document.getElementById('uberBtnContainer');
        if (dateEl.value) {
          timeEl.disabled = false;
          timeEl.innerHTML = '<option value="">Select time...</option>';
          for (let hour = 12; hour < 14; hour++) {
            for (let min = 0; min < 60; min += 15) {
              const startHour = hour > 12 ? hour - 12 : hour;
              const startSuffix = hour >= 12 ? 'pm' : 'am';
              const endMin = min + 15;
              const endHour = endMin >= 60 ? hour + 1 : hour;
              const endSuffix = endHour >= 12 ? 'pm' : 'am';
              const endDisplayHour = endHour > 12 ? endHour - 12 : endHour;
              const start = `${startHour}:${(min < 10 ? '0' : '')}${min}${startSuffix}`;
              const end = `${endDisplayHour}:${((endMin % 60) < 10 ? '0' : '')}${(endMin % 60)}${endSuffix}`;
              const option = document.createElement('option');
              option.value = start;
              option.textContent = start + ' - ' + end;
              timeEl.appendChild(option);
            }
          }
        } else {
          timeEl.disabled = true;
          timeEl.innerHTML = '<option value="">First select a date</option>';
        }
        if (type === 'delivery' && uberBtnContainer) {
          if (timeEl.value) {
            uberBtnContainer.innerHTML = `<button class="btn" id="reserveUberBtn">Reserve Uber</button>`;
            const reserveUberBtn = document.getElementById('reserveUberBtn');
            reserveUberBtn.addEventListener('click', () => {
              const uberAppLink = `uber://?action=setPickup&pickup[latitude]=${UBER_PICKUP_LATITUDE}&pickup[longitude]=${UBER_PICKUP_LONGITUDE}&pickup[nickname]=${encodeURIComponent(UBER_PICKUP_NICKNAME)}&pickup[formatted_address]=${encodeURIComponent(UBER_PICKUP_ADDRESS)}`;
              const uberWebLink = `https://m.uber.com/looking?pickup[latitude]=${UBER_PICKUP_LATITUDE}&pickup[longitude]=${UBER_PICKUP_LONGITUDE}&pickup[nickname]=${encodeURIComponent(UBER_PICKUP_NICKNAME)}&pickup[formatted_address]=${encodeURIComponent(UBER_PICKUP_ADDRESS)}`;
              showMessage("Opening Uber...");
              window.location.href = uberAppLink;
              setTimeout(() => {
                window.open(uberWebLink, '_blank');
              }, 1000);
            });
          } else {
            uberBtnContainer.innerHTML = '';
          }
        }
      }
      function setupEventListeners() {
        document.getElementById('pickupBtn').addEventListener('click', () => selectChoice('pickup'));
        document.getElementById('deliveryBtn').addEventListener('click', () => selectChoice('delivery'));
        document.getElementById('pickupDate').addEventListener('change', () => updateTimes('pickup'));
        document.getElementById('deliveryDate').addEventListener('change', () => updateTimes('delivery'));
        const deliveryTime = document.getElementById('deliveryTime');
        if (deliveryTime) {
          deliveryTime.addEventListener('change', () => updateTimes('delivery'));
        }
      }
      function init() {
        setupEventListeners();
      }
      return {
        init: init
      };
    })();

    const Modals = (function () {
      function setupModal(triggerId, modalId, closeId) {
        const openBtn = document.getElementById(triggerId);
        const modal = document.getElementById(modalId);
        const closeBtn = document.getElementById(closeId);
        if (!openBtn || !modal || !closeBtn) return;
        function openModal(e) {
          e?.preventDefault();
          modal.classList.add('show');
          modal.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
        }
        function closeModal() {
          modal.classList.remove('show');
          modal.setAttribute('aria-hidden', 'true');
          document.body.style.overflow = '';
        }
        openBtn.addEventListener('click', openModal);
        closeBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeModal();
        });
        return closeModal;
      }
      function init() {
        const closers = [
          setupModal('openStory', 'storyModal', 'closeStory'),
          setupModal('openWinter', 'winterModal', 'closeWinter'),
          setupModal('openSpring', 'springModal', 'closeSpring'),
          setupModal('openSummer', 'summerModal', 'closeSummer'),
          setupModal('openCooking', 'cookingModal', 'closeCooking')
        ].filter(Boolean);
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            closers.forEach(closeFn => closeFn());
          }
        });
      }
      return {
        init: init
      };
    })();

    const Checkout = (function (cartReader, messageSender) {
      async function createCheckoutSession(payload) {
        const res = await fetch('/api/checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) {
          const errorText = await res.text();
          throw new Error(`Failed to create checkout session: ${errorText}`);
        }
        return res.json();
      }
      async function handleSubmit(event) {
        event.preventDefault();
        const cartItems = cartReader();
        if (!cartItems.length) {
          messageSender('Please add at least one item.');
          return;
        }
        const customer = {
          name: document.getElementById('customerName').value.trim(),
          email: document.getElementById('customerEmail').value.trim(),
          phone: document.getElementById('customerPhone').value.trim(),
        };
        if (!customer.name || !customer.email || !customer.phone) {
          messageSender('Please enter name, email, and phone.');
          return;
        }
        const orderType = document.getElementById('pickupSchedule').style.display === 'block' ? 'pickup' : 'delivery';
        const slot = orderType === 'pickup'
          ? `${document.getElementById('pickupDate').value} ${document.getElementById('pickupTime').value}`
          : `${document.getElementById('deliveryDate').value} ${document.getElementById('deliveryTime').value}`;
        try {
          messageSender('Redirecting to Stripe...', 'success');
          const submitBtn = document.getElementById('submit-order');
          submitBtn.textContent = 'Processing...';
          submitBtn.disabled = true;
          const response = await createCheckoutSession({ cartItems, orderType, slot, customer });
          window.location.href = response.url;
        } catch (e) {
          messageSender('Checkout failed: ' + e.message, 'warning');
          const submitBtn = document.getElementById('submit-order');
          submitBtn.textContent = 'Complete Order';
          submitBtn.disabled = false;
        }
      }
      function init() {
        document.getElementById('submit-order').addEventListener('click', handleSubmit);
      }
      return {
        init: init
      };
    })(Cart.readCart, showMessage);

    document.addEventListener('DOMContentLoaded', () => {
      Cart.init();
      Fulfillment.init();
      Modals.init();
      Checkout.init();
    });
  </script>
</body>
</html>
